<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Reports - Otjiningirua West</title>
	<style>
		body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; margin: 20px; }
		.container { max-width: 1100px; margin: 0 auto; }
		.grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 12px; }
		.card { border: 1px solid #e5e7eb; border-radius: 8px; padding: 16px; }
		pre { white-space: pre-wrap; background: #f6f8fa; padding: 10px; border-radius: 6px; }
		.table { width: 100%; border-collapse: collapse; }
		th, td { border: 1px solid #e5e7eb; padding: 8px; text-align: left; font-size: 14px; }
		th { background: #f3f4f6; }
	</style>
</head>
<body>
	<div class="container">
		<h1>Business Analytics & Reports</h1>
		<p><a href="/admin/dashboard.html">Back to Dashboard</a> | <a href="#" onclick="logout()">Logout</a></p>
		<div class="grid">
			<div class="card">
				<h3>Download Overview Report (PDF)</h3>
				<p>Click the button to generate and download the latest business analytics report.</p>
				<button onclick="downloadReport()">Download Overview PDF</button>
			</div>
			<div class="card">
				<h3>Stock Summary (JSON)</h3>
				<pre id="stock"></pre>
			</div>
			<div class="card">
				<h3>Recent Activity (JSON)</h3>
				<pre id="logs"></pre>
			</div>
		</div>
	</div>

	<script>
		async function load() {
			const [summary, logs] = await Promise.all([
				fetch('/api/admin/stock/summary').then(r => r.json()),
				fetch('/api/admin/logs').then(r => r.json())
			]);
			document.getElementById('stock').textContent = JSON.stringify(summary, null, 2);
			document.getElementById('logs').textContent = JSON.stringify(logs.slice(-10), null, 2);
		}

		async function downloadReport(){
			const resp = await fetch('/api/admin/reports/overview');
			if(!resp.ok){ alert('Failed to generate report'); return; }
			const blob = await resp.blob();
			const url = URL.createObjectURL(blob);
			const a = document.createElement('a');
			a.href = url;
			a.download = 'overview-report.pdf';
			a.click();
			URL.revokeObjectURL(url);
		}
		load();
	</script>
	<script>
		(async function guard(){ const res = await fetch('/api/admin/session'); if (!res.ok) window.location.href = '/admin/login.html'; })();
		async function logout(){ await fetch('/api/admin/logout', { method: 'POST' }); window.location.href = '/admin/login.html'; }
	</script>
</body>
</html>